# jtop - JVM线程状态实时抓取工具

## 目录

- [1概述](#1-概述)
- [2适用场景](#2-适用场景)
- [3功能特点](#3-功能特点)
- [4安装步骤](#4-安装步骤)
- [5输出文件](#5-输出文件)
- [6注意事项](#6-注意事项)
- [7故障排查](#7-故障排查)
- [8支持](#8-支持)

## 1 概述

jtop (Java Thread Observer & Profiler) 是一个用于实时监控JVM的线程状态的工具，当线程数量超过预设阈值时，自动生成线程转储文件（Thread Dump）供后续分析。这对于排查线程相关问题、性能调优和系统监控非常有帮助。

## 2 适用场景

- Java应用程序
- 运行环境：macOS或Linux系统
- 特别适用于需要监控线程状态的生产环境
- 适用于需要进行性能调优和问题诊断的场景

## 3 功能特点

- 交互式选择要监控的Java进程
- 自动监控JVM线程数量
- 可配置监控阈值和检查间隔
- 自动生成带时间戳的线程转储文件
- 支持容器化环境
- 低资源占用

## 4 安装步骤

### 4.1 获取工具

将 [`jtop` 脚本](/JVM/Utils/jtop/jtop.sh)复制到你的系统中，确保它具有执行权限：

```bash
chmod +x jtop
```

### 4.2 使用方法

基本用法：
```bash
./jtop [选项]
```

可用选项：
- `-p <进程ID>`: 直接指定要监控的Java进程ID
- `-t <阈值>`: 设置线程数量阈值（默认：120）
- `-i <间隔>`: 设置检查间隔秒数（默认：10）
- `-d <目录>`: 设置转储文件保存目录（默认：/tmp/jvm_dumps）
- `-h`: 显示帮助信息

### 4.3 部署说明

##### 容器环境：
1. 将脚本复制到持久化卷中
2. 在容器启动命令中集成：
   ```bash
   nohup ${PathTo}/jtop && java ...
   ```

##### 非容器环境：
1. 将脚本复制到目标服务器
2. 赋予执行权限：`chmod +x jtop`
3. 直接在后台运行：`nohup ./jtop &`

## 5 输出文件

线程转储文件命名格式：`threaddump_[PID]_[时间戳].txt`

示例：`threaddump_1234_20241218_165744.txt`

## 6 注意事项

1. 确保系统已安装JDK（需要jps和jstack命令）
2. 确保脚本具有足够的执行权限
3. 确保输出目录具有写入权限
4. 定期清理历史转储文件，避免磁盘空间占用过大
5. 建议根据系统实际情况调整监控阈值和检查间隔

## 7 故障排查

如果工具无法正常工作，请检查：
1. Java进程是否正常运行
2. 脚本执行权限是否正确
3. 输出目录是否存在且有写入权限
4. jps和jstack命令是否可用
5. 是否有权限访问目标Java进程

## 8 支持

如有任何问题或建议，请联系我们。